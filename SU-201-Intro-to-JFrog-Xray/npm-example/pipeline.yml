template: true   # required for local templates
valuesFilePath: ./values.yml

resources:
  - name: npm_example
    type: GitRepo
    configuration:
      # SCM integration where the repository is located
      gitProvider: {{ .Values.myRepo.gitProvider }} 
      # Repository path, including org name/repo name
      path: {{ .Values.myRepo.path }} 
      branches:
        # Specifies which branches will trigger dependent steps
        include: {{ .Values.myRepo.branch }} 

  - name: myBuildInfo
    type: BuildInfo
    configuration:
      sourceArtifactory: Artifactory

pipelines:
  - name: npm_example_pipeline
    configuration:
      environmentVariables:
        readOnly:
          my_app_ver: '1.0.$run_number'
    steps:
      - name: npm_build_step
        type: NpmBuild
        configuration:
          sourceLocation: SU-201-Intro-to-JFrog-Xray/npm-example
          repositoryName: su201-npm-dev-local
          integrations:
            - name: Artifactory
          inputResources:
            - name: npm_example

      - name: npm_publish_step
        type: NpmPublish
        configuration:
          repositoryName: su201-npm-dev-local
          autoPublishBuildInfo: true       # optional
          inputSteps:
            - name: npm_build_step
          integrations:
            - name: Artifactory
          outputResources:
            - name: buildinfo_npm_example                 # optional
        execution:
          onStart:
            - export inputNpmBuildStepName="npm_build_step"